(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-2d2101ec"],{b712:function(e,t,s){"use strict";s.r(t);var i=s("8a49"),l=s("2755"),o={name:"SearchGroup",data(){return{typeList:[{text:"All type",id:"all"},{text:"Picture Book",id:"book"},{text:"Video",id:"video"}],selectType:"all",searchRname:"",selectSortType:"",searchStatus:!1,tempSearchName:"",textbookList:[],courseid:this.$route.params.courseid,colSortList:[],setAlllevel:"",selectLevelList:[],levelLists:[],haveLevel:!1,courseInfo:{},collectionInfo:{}}},props:["mfilter","page"],methods:{clearLevelFilter(){this.selectLevelList=[]},removeLevel(e){let t=this,s=this.selectLevelList.indexOf(e);-1!==s&&t.selectLevelList.splice(s,1)},async searchCourseResource(){let e=this;""!==this.searchRname?(this.searchStatus=!0,this.tempSearchName=this.searchRname):this.searchStatus=!1;let t=this.selectType;"all"===this.selectType&&(t="*");let s={type:t,keyword:this.searchRname};await i.d.post(this.courseid,s).then(t=>{if(""===e.selectSortType&&(0!==t.csrInfo.cntLevel?(e.haveLevel=!0,e.selectSortType="level_asc"):(e.haveLevel=!1,e.selectSortType="unit_asc")),t.record.forEach(t=>{void 0===t.level||""===t.level||e.levelLists.includes(t.level)||e.levelLists.push(t.level),void 0===t.unit&&(t.unit=""),t.link=t.information.includes("http")}),this.levelLists.sort(),this.textbookList=t.record,"success"===t.status)return!0}).catch(e=>{})&&(console.log("get course"),this.$emit("getMList",this.sortMList),this.$emit("getFilterInfo",this.selectLevelList,this.selectSortType))},async searchCollectionResource(){let e=this,t=this.selectType,s=this.searchRname;"all"===this.selectType&&(t="*"),""===this.searchRname&&(s="*"),""!==this.searchRname?(this.searchStatus=!0,this.tempSearchName=this.searchRname):this.searchStatus=!1,await l.k.get(this.userid,this.$route.params.cid,s,t).then(t=>{if(""===e.selectSortType&&(0!==t.moreInfo.cntLevel?(e.haveLevel=!0,e.selectSortType="level_asc"):(e.haveLevel=!1,e.selectSortType="unit_asc")),t.record.forEach(t=>{void 0===t.level||""===t.level||e.levelLists.includes(t.level)||e.levelLists.push(t.level),t.lastplay=[],t.last_access_all.forEach(e=>{"0"!==e.last_access&&t.lastplay.push(e)})}),this.textbookList=t.record,0===t.moreInfo.cntLevel){let t=[{text:"Sort by title A to Z",id:"title_asc"},{text:"Sort by title Z to A",id:"title_desc"},{text:"Sort by unit Smallest to Largest",id:"unit_asc"},{text:"Sort by unit Largest to Smallest",id:"unit_desc"}];e.$store.dispatch("common/setSortTypeList",t)}else if(0===t.moreInfo.cntUnit){let t=[{text:"Sort by title A to Z",id:"title_asc"},{text:"Sort by title Z to A",id:"title_desc"},{text:"Sort by level A to Z",id:"level_asc"},{text:"Sort by level Z to A",id:"level_desc"}];e.$store.dispatch("common/setSortTypeList",t)}if("success"===t.status)return!0}).catch(e=>{})&&this.$emit("getMColList",this.sortMList)},selectAllLevel(e){const t=this;e.currentTarget.checked?(t.selectLevelList=[],t.levelLists.forEach((function(e,s){t.selectLevelList.push(e)}))):t.selectLevelList=[]}},created(){this.openedTextbookList=this.openedTextbookLists,"collection"!==this.page?this.searchCourseResource():this.searchCollectionResource(),this.courseInfo=this.courseInfos},computed:{courseInfos(){return this.$store.state.courseInfo.courseInfo},userid(){return this.$store.state.auth.userid},sortMList(){console.log("start sort");let e=[];return e="openm"===this.mfilter?this.$_sortMaterial(this.openedMList,this.selectSortType,this.selectLevelList):"openb"===this.mfilter?this.$_sortMaterial(this.openedBookList,this.selectSortType,this.selectLevelList):"openv"===this.mfilter?this.$_sortMaterial(this.openedVideoList,this.selectSortType,this.selectLevelList):this.$_sortMaterial(this.textbookList,this.selectSortType,this.selectLevelList),e},sortTypeList(){return this.$store.state.common.sortTypeList},openedMList(){return this.textbookList.filter(e=>"true"===e.openflag)},openedBookList(){return this.textbookList.filter(e=>"true"===e.openflag&&"book"===e.note)},openedVideoList(){return this.textbookList.filter(e=>"true"===e.openflag&&"video"===e.note)},openedTextbookLists(){return this.$store.state.courseInfo.openedTextbookList}},watch:{courseInfo(){if("CollectionDetail"!==this.$route.name)if(0===this.courseInfo.cntLevel){let e=[{text:"Sort by title A to Z",id:"title_asc"},{text:"Sort by title Z to A",id:"title_desc"},{text:"Sort by unit Smallest to Largest",id:"unit_asc"},{text:"Sort by unit Largest to Smallest",id:"unit_desc"}];this.$store.dispatch("common/setSortTypeList",e)}else if(0===this.courseInfo.cntUnit){let e=[{text:"Sort by title A to Z",id:"title_asc"},{text:"Sort by title Z to A",id:"title_desc"},{text:"Sort by level A to Z",id:"level_asc"},{text:"Sort by level Z to A",id:"level_desc"}];this.$store.dispatch("common/setSortTypeList",e)}else{let e=[{text:"Sort by title A to Z",id:"title_asc"},{text:"Sort by title Z to A",id:"title_desc"},{text:"Sort by level A to Z",id:"level_asc"},{text:"Sort by level Z to A",id:"level_desc"},{text:"Sort by unit Smallest to Largest",id:"unit_asc"},{text:"Sort by unit Largest to Smallest",id:"unit_desc"}];this.$store.dispatch("common/setSortTypeList",e)}},courseInfos(){this.courseInfo=this.courseInfos},selectLevelList(){"collection"!==this.page?this.searchCourseResource():this.searchCollectionResource()},mfilter(){"collection"!==this.page?this.searchCourseResource():this.searchCollectionResource()},selectSortType(){"collection"!==this.page?this.searchCourseResource():this.searchCollectionResource()},openedTextbookLists(){this.openedTextbookList=this.openedTextbookLists},searchRname(){"collection"!==this.page?this.searchCourseResource():this.searchCollectionResource()},selectType(){"collection"!==this.page?this.searchCourseResource():this.searchCollectionResource()}}},r=s("2877"),c=Object(r.a)(o,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"pb-3"},[s("div",{staticClass:"form-row"},[s("div",{staticClass:"form-group form-rounded mb-0 mr-3"},[s("select2",{attrs:{id:"s2_demo2",options:e.typeList},model:{value:e.selectType,callback:function(t){e.selectType=t},expression:"selectType"}})],1),s("div",{staticClass:"form-group form-rounded mb-0 mr-3"},[s("div",{staticClass:"input-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.searchRname,expression:"searchRname"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Search materials"},domProps:{value:e.searchRname},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchCourseResource()},input:function(t){t.target.composing||(e.searchRname=t.target.value)}}}),s("div",{staticClass:"input-group-append"},[s("div",{staticClass:"btn btn-secondary btn-outline btn-icon btn-rounded",attrs:{type:"button"},on:{click:function(t){return e.searchCourseResource()}}},[s("i",{staticClass:"zmdi zmdi-search text-secondary"})])])])]),s("div",{staticClass:"form-group form-rounded mb-0 mr-3"},[s("select2",{attrs:{id:"s2_demo3",options:e.sortTypeList},model:{value:e.selectSortType,callback:function(t){e.selectSortType=t},expression:"selectSortType"}})],1),e.haveLevel?s("div",{staticClass:"form-group form-rounded mb-0 text-secondary",attrs:{"data-dismiss":"modal","data-toggle":"modal","data-target":"#filterModal"},on:{click:function(t){e.setAlllevel=""}}},[e._m(0)]):e._e()]),e.searchStatus||0!==e.selectLevelList.length?s("div",{staticClass:"mb-0 mr-3 text-secondary mt-2"},[s("div",{staticClass:"row col-sm-12"},[s("strong",{staticClass:"col-sm-12"},[s("span",{staticClass:"mr-1"},[e._v(e._s(e.sortMList.length))]),e._v(" "+e._s(e.$t("listings-for"))),""!==e.tempSearchName?s("span",[e._v(" “ "+e._s(e.searchRname)+" ” ")]):e._e()]),0!==e.selectLevelList.length?s("div",{staticClass:"col-sm-12"},[e._l(e.selectLevelList,(function(t){return s("span",{key:t},[s("span",{staticClass:"badge badge-pill badge-secondary mr-2 mb-2 pointer",on:{click:function(s){return e.removeLevel(t)}}},[e._v("Level "+e._s(t)+" "),e._m(1,!0)])])})),s("span",{staticClass:"text-primary pointer",on:{click:function(t){return e.clearLevelFilter()}}},[e._v("Clear all")])],2):e._e()])]):e._e(),s("div",{staticClass:"modal fade",attrs:{id:"filterModal",tabindex:"-1",role:"dialog","aria-hidden":"true"}},[s("div",{staticClass:"modal-dialog modal-dialog-centered",attrs:{role:"document"}},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-header"},[s("h5",{staticClass:"modal-title",attrs:{id:"ModalTitle1"}},[e._v(e._s(e.$t("filter")))]),e._m(2)]),s("div",{staticClass:"modal-body"},[s("p",[e._v("Filter by level")]),s("div",{staticClass:"col-sm-12 row"},e._l(e.levelLists,(function(t,i){return s("div",{key:t+i,staticClass:"col-4"},[s("div",{staticClass:"custom-control custom-checkbox mr-2"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.selectLevelList,expression:"selectLevelList"}],staticClass:"custom-control-input",attrs:{type:"checkbox",id:t},domProps:{value:t,checked:Array.isArray(e.selectLevelList)?e._i(e.selectLevelList,t)>-1:e.selectLevelList},on:{change:function(s){var i=e.selectLevelList,l=s.target,o=!!l.checked;if(Array.isArray(i)){var r=t,c=e._i(i,r);l.checked?c<0&&(e.selectLevelList=i.concat([r])):c>-1&&(e.selectLevelList=i.slice(0,c).concat(i.slice(c+1)))}else e.selectLevelList=o}}}),s("label",{staticClass:"custom-control-label",attrs:{for:t}},[e._v("Level "+e._s(t))])])])})),0)])])])])])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"btn btn-secondary btn-outline btn-icon btn-rounded d-flex justify-content-center align-items-center"},[t("i",{staticClass:"zmdi zmdi-filter-list mx-0"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"ml-1"},[t("i",{staticClass:"zmdi zmdi-close"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[t("span",{staticClass:"zmdi zmdi-close",attrs:{"aria-hidden":"true"}})])}],!1,null,null,null);t.default=c.exports}}]);
//# sourceMappingURL=chunk-2d2101ec.04636dda.js.map